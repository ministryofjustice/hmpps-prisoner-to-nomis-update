{
  "openapi" : "3.1.0",
  "info" : {
    "title" : "HMPPS Prisoner Finance Sync API",
    "description" : "API for synchronising NOMIS transactions with the Prisoner Finance Ledger.\n\n## Authentication\nThis API uses **OAuth2 with JWTs**. Pass your JWT in the `Authorization` header using the `Bearer` scheme.\n**Important:** This service is designed for client tokens only; user tokens should not be used.\n\n## Authorization\nAccess to API endpoints is controlled by roles. The required roles are documented with each endpoint.\nIntegrations should request one of the following roles based on their needs:\n\n* `ROLE_PRISONER_FINANCE_SYNC__RW`: Grants **read/write access** to the NOMIS sync endpoints.\n* `ROLE_PRISONER_FINANCE_SYNC__AUDIT__RO`: Grants **read only access** to the Sync audit endpoints.",
    "contact" : {
      "name" : "HMPPS Digital Studio",
      "email" : "feedback@digital.justice.gov.uk"
    },
    "version" : "2026-02-02.447.6cc4a77"
  },
  "servers" : [ {
    "url" : "https://prisoner-finance-sync-api-dev.hmpps.service.justice.gov.uk/",
    "description" : "Development"
  }, {
    "url" : "https://prisoner-finance-sync-api-preprod.hmpps.service.justice.gov.uk/",
    "description" : "Pre-Production"
  }, {
    "url" : "https://prisoner-finance-sync-api.hmpps.service.justice.gov.uk/",
    "description" : "Production"
  }, {
    "url" : "http://localhost:8080",
    "description" : "Local"
  } ],
  "security" : [ {
    "bearer-jwt" : [ ]
  } ],
  "tags" : [ {
    "name" : "NOMIS Sync",
    "description" : "Endpoints exclusively for NOMIS synchronization. Do not use for other client integrations."
  } ],
  "paths" : {
    "/queue-admin/retry-dlq/{dlqName}" : {
      "put" : {
        "tags" : [ "hmpps-queue-resource" ],
        "operationId" : "retryDlq",
        "parameters" : [ {
          "name" : "dlqName",
          "in" : "path",
          "required" : true,
          "schema" : {
            "type" : "string"
          }
        } ],
        "responses" : {
          "200" : {
            "description" : "OK",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/RetryDlqResult"
                }
              }
            }
          }
        }
      }
    },
    "/queue-admin/retry-all-dlqs" : {
      "put" : {
        "tags" : [ "hmpps-queue-resource" ],
        "operationId" : "retryAllDlqs",
        "responses" : {
          "200" : {
            "description" : "OK",
            "content" : {
              "*/*" : {
                "schema" : {
                  "type" : "array",
                  "items" : {
                    "$ref" : "#/components/schemas/RetryDlqResult"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/queue-admin/purge-queue/{queueName}" : {
      "put" : {
        "tags" : [ "hmpps-queue-resource" ],
        "operationId" : "purgeQueue",
        "parameters" : [ {
          "name" : "queueName",
          "in" : "path",
          "required" : true,
          "schema" : {
            "type" : "string"
          }
        } ],
        "responses" : {
          "200" : {
            "description" : "OK",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/PurgeQueueResult"
                }
              }
            }
          }
        }
      }
    },
    "/sync/offender-transactions" : {
      "get" : {
        "tags" : [ "NOMIS Sync" ],
        "summary" : "Retrieve offender transactions by date range",
        "description" : "Fetches a list of offender transactions within a specified start and end date.",
        "operationId" : "getOffenderTransactionsByDate",
        "parameters" : [ {
          "name" : "startDate",
          "in" : "query",
          "required" : true,
          "schema" : {
            "type" : "string",
            "format" : "date"
          }
        }, {
          "name" : "endDate",
          "in" : "query",
          "required" : true,
          "schema" : {
            "type" : "string",
            "format" : "date"
          }
        }, {
          "name" : "page",
          "in" : "query",
          "required" : false,
          "schema" : {
            "type" : "integer",
            "format" : "int32",
            "default" : 0
          }
        }, {
          "name" : "size",
          "in" : "query",
          "required" : false,
          "schema" : {
            "type" : "integer",
            "format" : "int32",
            "default" : 20
          }
        } ],
        "responses" : {
          "200" : {
            "description" : "Offender transactions successfully retrieved.",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/SyncOffenderTransactionListResponse"
                }
              }
            }
          },
          "400" : {
            "description" : "Bad request - invalid date format or range.",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401" : {
            "description" : "Unauthorized - requires a valid OAuth2 token",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403" : {
            "description" : "Forbidden - requires an appropriate role",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500" : {
            "description" : "Internal Server Error - An unexpected error occurred.",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security" : [ {
          "bearer-jwt" : [ "ROLE_PRISONER_FINANCE_SYNC__RW" ]
        } ]
      },
      "post" : {
        "tags" : [ "NOMIS Sync" ],
        "summary" : "Synchronize offender transactions",
        "description" : "\n      Transactions that have not been posted before will be created.\n      Those that have already been posted and can be identified will be updated with metadata only.\n      If the core details of a transaction have changed, the ledger will need to reverse the original transaction and post a new one.\n    ",
        "operationId" : "postOffenderTransaction",
        "requestBody" : {
          "content" : {
            "application/json" : {
              "schema" : {
                "$ref" : "#/components/schemas/SyncOffenderTransactionRequest"
              }
            }
          },
          "required" : true
        },
        "responses" : {
          "201" : {
            "description" : "Offender transaction successfully created.",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/SyncTransactionReceipt"
                }
              }
            }
          },
          "200" : {
            "description" : "Offender transaction metadata successfully updated or processed with no new creations.",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/SyncTransactionReceipt"
                }
              }
            }
          },
          "400" : {
            "description" : "Bad request - invalid input data.",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401" : {
            "description" : "Unauthorized - requires a valid OAuth2 token",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403" : {
            "description" : "Forbidden - requires an appropriate role",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500" : {
            "description" : "Internal Server Error - An unexpected error occurred.",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security" : [ {
          "bearer-jwt" : [ "ROLE_PRISONER_FINANCE_SYNC__RW" ]
        } ]
      }
    },
    "/sync/general-ledger-transactions" : {
      "get" : {
        "tags" : [ "NOMIS Sync" ],
        "summary" : "Retrieve general ledger transactions by date range",
        "description" : "Fetches a list of general ledger transactions within a specified start and end date.",
        "operationId" : "getGeneralLedgerTransactionsByDate",
        "parameters" : [ {
          "name" : "startDate",
          "in" : "query",
          "required" : true,
          "schema" : {
            "type" : "string",
            "format" : "date"
          }
        }, {
          "name" : "endDate",
          "in" : "query",
          "required" : true,
          "schema" : {
            "type" : "string",
            "format" : "date"
          }
        }, {
          "name" : "page",
          "in" : "query",
          "required" : false,
          "schema" : {
            "type" : "integer",
            "format" : "int32",
            "default" : 0
          }
        }, {
          "name" : "size",
          "in" : "query",
          "required" : false,
          "schema" : {
            "type" : "integer",
            "format" : "int32",
            "default" : 20
          }
        } ],
        "responses" : {
          "200" : {
            "description" : "General ledger transactions successfully retrieved.",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/SyncGeneralLedgerTransactionListResponse"
                }
              }
            }
          },
          "400" : {
            "description" : "Bad request - invalid date format or range.",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401" : {
            "description" : "Unauthorized - requires a valid OAuth2 token",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403" : {
            "description" : "Forbidden - requires an appropriate role",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500" : {
            "description" : "Internal Server Error - An unexpected error occurred.",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security" : [ {
          "bearer-jwt" : [ "ROLE_PRISONER_FINANCE_SYNC__RW" ]
        } ]
      },
      "post" : {
        "tags" : [ "NOMIS Sync" ],
        "summary" : "Synchronize general ledger transactions",
        "description" : "\n      General ledger transactions that have not been posted before will be created.\n      Those that have already been posted and can be identified will be updated with metadata only.\n      If the core details of a transaction have changed, the ledger will need to reverse the original transaction and post a new one.\n    ",
        "operationId" : "postGeneralLedgerTransaction",
        "requestBody" : {
          "content" : {
            "application/json" : {
              "schema" : {
                "$ref" : "#/components/schemas/SyncGeneralLedgerTransactionRequest"
              }
            }
          },
          "required" : true
        },
        "responses" : {
          "201" : {
            "description" : "General ledger transaction successfully posted.",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/SyncTransactionReceipt"
                }
              }
            }
          },
          "200" : {
            "description" : "General ledger transaction metadata successfully updated or processed with no new creations.",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/SyncTransactionReceipt"
                }
              }
            }
          },
          "400" : {
            "description" : "Bad request - invalid input data.",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401" : {
            "description" : "Unauthorized - requires a valid OAuth2 token",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403" : {
            "description" : "Forbidden - requires an appropriate role",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500" : {
            "description" : "Internal Server Error - An unexpected error occurred.",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security" : [ {
          "bearer-jwt" : [ "ROLE_PRISONER_FINANCE_SYNC__RW" ]
        } ]
      }
    },
    "/migrate/prisoner-balances/{prisonNumber}" : {
      "post" : {
        "tags" : [ "NOMIS Sync" ],
        "summary" : "Migrate a prisoners balances",
        "description" : "Migrate a prisoners sub-accounts (e.g., Spends, Private Cash) to a given balance from a legacy system.",
        "operationId" : "migratePrisonerBalances",
        "parameters" : [ {
          "name" : "prisonNumber",
          "in" : "path",
          "required" : true,
          "schema" : {
            "type" : "string"
          }
        } ],
        "requestBody" : {
          "content" : {
            "application/json" : {
              "schema" : {
                "$ref" : "#/components/schemas/PrisonerBalancesSyncRequest"
              }
            }
          },
          "required" : true
        },
        "responses" : {
          "200" : {
            "description" : "Prisoner balances successfully migrated."
          },
          "400" : {
            "description" : "Bad request - invalid input data.",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401" : {
            "description" : "Unauthorized - requires a valid OAuth2 token",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403" : {
            "description" : "Forbidden - requires an appropriate role",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500" : {
            "description" : "Internal Server Error - An unexpected error occurred.",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security" : [ {
          "bearer-jwt" : [ "ROLE_PRISONER_FINANCE_SYNC__RW" ]
        } ]
      }
    },
    "/migrate/general-ledger-balances/{prisonId}" : {
      "post" : {
        "tags" : [ "NOMIS Sync" ],
        "summary" : "Migrate general ledger balances for a single prison",
        "description" : "Migrate general ledger account balances for a specific prison.",
        "operationId" : "migrateGeneralLedgerBalances",
        "parameters" : [ {
          "name" : "prisonId",
          "in" : "path",
          "required" : true,
          "schema" : {
            "type" : "string"
          }
        } ],
        "requestBody" : {
          "content" : {
            "application/json" : {
              "schema" : {
                "$ref" : "#/components/schemas/GeneralLedgerBalancesSyncRequest"
              }
            }
          },
          "required" : true
        },
        "responses" : {
          "200" : {
            "description" : "General ledger balances successfully migrated."
          },
          "400" : {
            "description" : "Bad request - invalid input data.",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401" : {
            "description" : "Unauthorized - requires a valid OAuth2 token",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403" : {
            "description" : "Forbidden - requires an appropriate role",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500" : {
            "description" : "Internal Server Error - An unexpected error occurred.",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security" : [ {
          "bearer-jwt" : [ "ROLE_PRISONER_FINANCE_SYNC__RW" ]
        } ]
      }
    },
    "/sync/offender-transactions/{id}" : {
      "get" : {
        "tags" : [ "NOMIS Sync" ],
        "summary" : "Retrieve an offender transaction by its ID",
        "description" : "Fetches a single offender transaction by its ID.",
        "operationId" : "getOffenderTransactionById",
        "parameters" : [ {
          "name" : "id",
          "in" : "path",
          "required" : true,
          "schema" : {
            "type" : "string",
            "format" : "uuid"
          }
        } ],
        "responses" : {
          "200" : {
            "description" : "Offender transaction successfully retrieved.",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/SyncOffenderTransactionResponse"
                }
              }
            }
          },
          "404" : {
            "description" : "Not Found - The specified transaction ID was not found.",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401" : {
            "description" : "Unauthorized - requires a valid OAuth2 token",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403" : {
            "description" : "Forbidden - requires an appropriate role",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500" : {
            "description" : "Internal Server Error - An unexpected error occurred.",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security" : [ {
          "bearer-jwt" : [ "ROLE_PRISONER_FINANCE_SYNC__RW" ]
        } ]
      }
    },
    "/sync/general-ledger-transactions/{id}" : {
      "get" : {
        "tags" : [ "NOMIS Sync" ],
        "summary" : "Retrieve a single general ledger transaction",
        "description" : "Fetches a single general ledger transaction by its ID.",
        "operationId" : "getGeneralLedgerTransactionById",
        "parameters" : [ {
          "name" : "id",
          "in" : "path",
          "required" : true,
          "schema" : {
            "type" : "string",
            "format" : "uuid"
          }
        } ],
        "responses" : {
          "200" : {
            "description" : "General ledger transaction successfully retrieved.",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/SyncGeneralLedgerTransactionResponse"
                }
              }
            }
          },
          "404" : {
            "description" : "Not Found - The specified transaction was not found.",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401" : {
            "description" : "Unauthorized - requires a valid OAuth2 token",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403" : {
            "description" : "Forbidden - requires an appropriate role",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500" : {
            "description" : "Internal Server Error - An unexpected error occurred.",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security" : [ {
          "bearer-jwt" : [ "ROLE_PRISONER_FINANCE_SYNC__RW" ]
        } ]
      }
    },
    "/reconcile/prisoner-balances/{prisonNumber}" : {
      "get" : {
        "tags" : [ "NOMIS Sync" ],
        "summary" : "Get a list of all subaccount balances for a prisoner, grouped by establishment where transactions occurred",
        "operationId" : "listPrisonerBalancesByEstablishment",
        "parameters" : [ {
          "name" : "prisonNumber",
          "in" : "path",
          "required" : true,
          "schema" : {
            "type" : "string"
          }
        } ],
        "responses" : {
          "200" : {
            "description" : "OK",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/PrisonerEstablishmentBalanceDetailsList"
                }
              }
            }
          }
        },
        "security" : [ {
          "bearer-jwt" : [ "ROLE_PRISONER_FINANCE_SYNC__RW" ]
        } ]
      }
    },
    "/reconcile/general-ledger-balances/{prisonId}" : {
      "get" : {
        "tags" : [ "NOMIS Sync" ],
        "summary" : "Get a list of all general ledger balances accounts for a specific prison",
        "operationId" : "listGeneralLedgerBalances",
        "parameters" : [ {
          "name" : "prisonId",
          "in" : "path",
          "required" : true,
          "schema" : {
            "type" : "string"
          }
        } ],
        "responses" : {
          "200" : {
            "description" : "OK",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/GeneralLedgerBalanceDetailsList"
                }
              }
            }
          }
        },
        "security" : [ {
          "bearer-jwt" : [ "ROLE_PRISONER_FINANCE_SYNC__RW" ]
        } ]
      }
    },
    "/queue-admin/get-dlq-messages/{dlqName}" : {
      "get" : {
        "tags" : [ "hmpps-queue-resource" ],
        "operationId" : "getDlqMessages",
        "parameters" : [ {
          "name" : "dlqName",
          "in" : "path",
          "required" : true,
          "schema" : {
            "type" : "string"
          }
        }, {
          "name" : "maxMessages",
          "in" : "query",
          "required" : false,
          "schema" : {
            "type" : "integer",
            "format" : "int32",
            "default" : 100
          }
        } ],
        "responses" : {
          "200" : {
            "description" : "OK",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/GetDlqResult"
                }
              }
            }
          }
        }
      }
    },
    "/prisons/{prisonId}/reports/summary-of-payments-and-receipts" : {
      "get" : {
        "tags" : [ "Prison reports" ],
        "summary" : "Get a summary of payments and receipts for a specific prison",
        "operationId" : "getSummaryOfAccount",
        "parameters" : [ {
          "name" : "prisonId",
          "in" : "path",
          "required" : true,
          "schema" : {
            "type" : "string"
          }
        }, {
          "name" : "date",
          "in" : "query",
          "required" : true,
          "schema" : {
            "type" : "string",
            "format" : "date"
          }
        } ],
        "responses" : {
          "200" : {
            "description" : "OK",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/SummaryOfPaymentAndReceiptsReport"
                }
              }
            }
          },
          "404" : {
            "description" : "Prison not found",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security" : [ {
          "bearer-jwt" : [ "ROLE_PRISONER_FINANCE_SYNC__RW" ]
        } ]
      }
    },
    "/prisons/{prisonId}/accounts" : {
      "get" : {
        "tags" : [ "Prison accounts" ],
        "summary" : "Get a list of all accounts for a specific prison",
        "operationId" : "listPrisonAccounts",
        "parameters" : [ {
          "name" : "prisonId",
          "in" : "path",
          "required" : true,
          "schema" : {
            "type" : "string",
            "pattern" : "^[A-Za-z0-9]{3}$"
          }
        } ],
        "responses" : {
          "200" : {
            "description" : "OK",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/PrisonAccountDetailsList"
                }
              }
            }
          }
        },
        "security" : [ {
          "bearer-jwt" : [ "ROLE_PRISONER_FINANCE_SYNC__RW" ]
        } ]
      }
    },
    "/prisons/{prisonId}/accounts/{accountCode}" : {
      "get" : {
        "tags" : [ "Prison accounts" ],
        "summary" : "Get the details of a specific prison account",
        "operationId" : "getPrisonAccountDetails",
        "parameters" : [ {
          "name" : "prisonId",
          "in" : "path",
          "required" : true,
          "schema" : {
            "type" : "string",
            "pattern" : "^[A-Za-z0-9]{3}$"
          }
        }, {
          "name" : "accountCode",
          "in" : "path",
          "required" : true,
          "schema" : {
            "type" : "integer",
            "format" : "int32"
          }
        } ],
        "responses" : {
          "200" : {
            "description" : "OK",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/PrisonAccountDetails"
                }
              }
            }
          },
          "404" : {
            "description" : "Prison account not found",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security" : [ {
          "bearer-jwt" : [ "ROLE_PRISONER_FINANCE_SYNC__RW" ]
        } ]
      }
    },
    "/prisons/{prisonId}/accounts/{accountCode}/transactions" : {
      "get" : {
        "tags" : [ "Prison accounts" ],
        "summary" : "Get list of transactions for a specific account for a specific prison",
        "operationId" : "getPrisonAccountTransactions",
        "parameters" : [ {
          "name" : "prisonId",
          "in" : "path",
          "required" : true,
          "schema" : {
            "type" : "string",
            "pattern" : "^[A-Za-z0-9]{3}$"
          }
        }, {
          "name" : "accountCode",
          "in" : "path",
          "required" : true,
          "schema" : {
            "type" : "integer",
            "format" : "int32"
          }
        }, {
          "name" : "date",
          "in" : "query",
          "description" : "Optional filter by a specific business day",
          "required" : false,
          "schema" : {
            "type" : "string",
            "format" : "date"
          },
          "example" : "2023-01-25"
        } ],
        "responses" : {
          "200" : {
            "description" : "OK",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/TransactionDetailsList"
                }
              }
            }
          },
          "404" : {
            "description" : "Prison account not found",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security" : [ {
          "bearer-jwt" : [ "ROLE_PRISONER_FINANCE_SYNC__RW" ]
        } ]
      }
    },
    "/prisons/{prisonId}/accounts/{accountCode}/transactions/{transactionId}" : {
      "get" : {
        "tags" : [ "Prison accounts" ],
        "summary" : "Get a transaction for a specific account for a specific prison",
        "operationId" : "getPrisonAccountTransaction",
        "parameters" : [ {
          "name" : "prisonId",
          "in" : "path",
          "required" : true,
          "schema" : {
            "type" : "string",
            "pattern" : "^[A-Za-z0-9]{3}$"
          }
        }, {
          "name" : "accountCode",
          "in" : "path",
          "required" : true,
          "schema" : {
            "type" : "integer",
            "format" : "int32"
          }
        }, {
          "name" : "transactionId",
          "in" : "path",
          "required" : true,
          "schema" : {
            "type" : "string"
          }
        } ],
        "responses" : {
          "200" : {
            "description" : "OK",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/TransactionDetailsList"
                }
              }
            }
          },
          "404" : {
            "description" : "Prison account not found",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security" : [ {
          "bearer-jwt" : [ "ROLE_PRISONER_FINANCE_SYNC__RW" ]
        } ]
      }
    },
    "/prisoners/{prisonNumber}/accounts" : {
      "get" : {
        "tags" : [ "Prisoner trust accounts" ],
        "summary" : "Get a list of all subaccounts for a specific prisoner",
        "operationId" : "listPrisonerAccounts",
        "parameters" : [ {
          "name" : "prisonNumber",
          "in" : "path",
          "required" : true,
          "schema" : {
            "type" : "string"
          }
        } ],
        "responses" : {
          "200" : {
            "description" : "OK",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/PrisonerSubAccountDetailsList"
                }
              }
            }
          }
        },
        "security" : [ {
          "bearer-jwt" : [ "ROLE_PRISONER_FINANCE_SYNC__RW" ]
        } ]
      }
    },
    "/prisoners/{prisonNumber}/accounts/{accountCode}" : {
      "get" : {
        "tags" : [ "Prisoner trust accounts" ],
        "summary" : "Get the details of a specific account for a prisoner",
        "operationId" : "getPrisonerSubAccountDetails",
        "parameters" : [ {
          "name" : "prisonNumber",
          "in" : "path",
          "required" : true,
          "schema" : {
            "type" : "string"
          }
        }, {
          "name" : "accountCode",
          "in" : "path",
          "required" : true,
          "schema" : {
            "type" : "integer",
            "format" : "int32"
          }
        } ],
        "responses" : {
          "200" : {
            "description" : "OK",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/PrisonerSubAccountDetails"
                }
              }
            }
          },
          "404" : {
            "description" : "Prisoner account not found",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security" : [ {
          "bearer-jwt" : [ "ROLE_PRISONER_FINANCE_SYNC__RW" ]
        } ]
      }
    },
    "/prisoners/{prisonNumber}/accounts/{accountCode}/transactions" : {
      "get" : {
        "tags" : [ "Prisoner trust accounts" ],
        "summary" : "Get list of transactions for a specific sub account for a specific prisoner",
        "operationId" : "getPrisonerAccountTransactions",
        "parameters" : [ {
          "name" : "prisonNumber",
          "in" : "path",
          "required" : true,
          "schema" : {
            "type" : "string"
          }
        }, {
          "name" : "accountCode",
          "in" : "path",
          "required" : true,
          "schema" : {
            "type" : "integer",
            "format" : "int32"
          }
        } ],
        "responses" : {
          "200" : {
            "description" : "OK",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/TransactionDetailsList"
                }
              }
            }
          },
          "404" : {
            "description" : "Prisoner account not found",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security" : [ {
          "bearer-jwt" : [ "ROLE_PRISONER_FINANCE_SYNC__RW" ]
        } ]
      }
    },
    "/prisoners/{prisonNumber}/accounts/{accountCode}/transactions/{transactionId}" : {
      "get" : {
        "tags" : [ "Prisoner trust accounts" ],
        "summary" : "Get a transaction for a specific sub account for a specific prisoner",
        "operationId" : "getPrisonerAccountTransaction",
        "parameters" : [ {
          "name" : "prisonNumber",
          "in" : "path",
          "required" : true,
          "schema" : {
            "type" : "string"
          }
        }, {
          "name" : "accountCode",
          "in" : "path",
          "required" : true,
          "schema" : {
            "type" : "integer",
            "format" : "int32"
          }
        }, {
          "name" : "transactionId",
          "in" : "path",
          "required" : true,
          "schema" : {
            "type" : "string"
          }
        } ],
        "responses" : {
          "200" : {
            "description" : "OK",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/TransactionDetailsList"
                }
              }
            }
          },
          "404" : {
            "description" : "Prisoner account not found",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security" : [ {
          "bearer-jwt" : [ "ROLE_PRISONER_FINANCE_SYNC__RW" ]
        } ]
      }
    },
    "/audit/history" : {
      "get" : {
        "tags" : [ "Audit" ],
        "summary" : "Get Audit History",
        "description" : "Get a list of synced payloads, including NOMIS' legacy IDs",
        "operationId" : "getMatchingPayloads",
        "parameters" : [ {
          "name" : "prisonId",
          "in" : "query",
          "required" : false,
          "schema" : {
            "type" : "string",
            "pattern" : "^[A-Za-z0-9]{3}$"
          }
        }, {
          "name" : "legacyTransactionId",
          "in" : "query",
          "required" : false,
          "schema" : {
            "type" : "integer",
            "format" : "int64"
          }
        }, {
          "name" : "startDate",
          "in" : "query",
          "required" : false,
          "schema" : {
            "type" : "string",
            "format" : "date"
          }
        }, {
          "name" : "endDate",
          "in" : "query",
          "required" : false,
          "schema" : {
            "type" : "string",
            "format" : "date"
          }
        }, {
          "name" : "page",
          "in" : "query",
          "required" : false,
          "schema" : {
            "type" : "integer",
            "format" : "int32",
            "default" : 0
          }
        }, {
          "name" : "size",
          "in" : "query",
          "required" : false,
          "schema" : {
            "type" : "integer",
            "format" : "int32",
            "default" : 20
          }
        } ],
        "responses" : {
          "200" : {
            "description" : "Returns list of captured sync payloads.",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/PageNomisSyncPayloadSummary"
                }
              }
            }
          },
          "400" : {
            "description" : "Bad request - invalid input data.",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401" : {
            "description" : "Unauthorized - requires a valid OAuth2 token",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403" : {
            "description" : "Forbidden - requires an appropriate role",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500" : {
            "description" : "Internal Server Error - An unexpected error occurred.",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security" : [ {
          "bearer-jwt" : [ "ROLE_PRISONER_FINANCE_SYNC__AUDIT__RO" ]
        } ]
      }
    },
    "/audit/history/{requestId}" : {
      "get" : {
        "tags" : [ "Audit" ],
        "summary" : "Get Payloads Details",
        "description" : "Get the full payload details (including the JSON body) for a specific request ID.",
        "operationId" : "getPayloadByRequestId",
        "parameters" : [ {
          "name" : "requestId",
          "in" : "path",
          "required" : true,
          "schema" : {
            "type" : "string",
            "format" : "uuid"
          }
        } ],
        "responses" : {
          "200" : {
            "description" : "Returns the Payload matching the requestId provided.",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/NomisSyncPayloadDetail"
                }
              }
            }
          },
          "400" : {
            "description" : "Bad request - invalid input data.",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401" : {
            "description" : "Unauthorized - requires a valid OAuth2 token",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403" : {
            "description" : "Forbidden - requires an appropriate role",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404" : {
            "description" : "Not Found - No Payload found with requestId provided",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500" : {
            "description" : "Internal Server Error - An unexpected error occurred.",
            "content" : {
              "*/*" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security" : [ {
          "bearer-jwt" : [ "ROLE_PRISONER_FINANCE_SYNC__AUDIT__RO" ]
        } ]
      }
    }
  },
  "components" : {
    "schemas" : {
      "RetryDlqResult" : {
        "type" : "object",
        "properties" : {
          "messagesFoundCount" : {
            "type" : "integer",
            "format" : "int32"
          }
        },
        "required" : [ "messagesFoundCount" ]
      },
      "PurgeQueueResult" : {
        "type" : "object",
        "properties" : {
          "messagesFoundCount" : {
            "type" : "integer",
            "format" : "int32"
          }
        },
        "required" : [ "messagesFoundCount" ]
      },
      "GeneralLedgerEntry" : {
        "type" : "object",
        "description" : "Represents a general ledger entry.",
        "properties" : {
          "entrySequence" : {
            "type" : "integer",
            "format" : "int32",
            "description" : "The sequence number for this specific general ledger entry.",
            "example" : 1
          },
          "code" : {
            "type" : "integer",
            "format" : "int32",
            "description" : "The general ledger account code.",
            "example" : 2101
          },
          "postingType" : {
            "type" : "string",
            "description" : "Indicates whether the entry is a Debit (DR) or Credit (CR).",
            "enum" : [ "DR", "CR" ],
            "example" : "DR"
          },
          "amount" : {
            "type" : "number",
            "format" : "double",
            "description" : "The monetary amount of the general ledger entry.",
            "example" : 162.0
          }
        },
        "required" : [ "amount", "code", "entrySequence", "postingType" ]
      },
      "OffenderTransaction" : {
        "type" : "object",
        "description" : "Represents a single offender transaction entry, including related general ledger entries.",
        "properties" : {
          "entrySequence" : {
            "type" : "integer",
            "format" : "int32",
            "description" : "The sequence number for this specific offender transaction entry.",
            "example" : 1
          },
          "offenderId" : {
            "type" : "integer",
            "format" : "int64",
            "description" : "The internal ID of the offender.",
            "example" : 1015388
          },
          "offenderDisplayId" : {
            "type" : "string",
            "description" : "The display ID for the offender.",
            "example" : "AA001AA"
          },
          "offenderBookingId" : {
            "type" : "integer",
            "format" : "int64",
            "description" : "The booking ID of the offender transaction.",
            "example" : 455987
          },
          "subAccountType" : {
            "type" : "string",
            "description" : "The sub-account type (e.g., REG, SPND, SAV).",
            "example" : "REG"
          },
          "postingType" : {
            "type" : "string",
            "description" : "The type of posting (DR/CR).",
            "enum" : [ "DR", "CR" ],
            "example" : "DR"
          },
          "type" : {
            "type" : "string",
            "description" : "The type of transaction (e.g., OT, DISCP).",
            "example" : "OT"
          },
          "description" : {
            "type" : "string",
            "description" : "A description of the transaction entry.",
            "example" : "Sub-Account Transfer"
          },
          "amount" : {
            "type" : "number",
            "format" : "double",
            "description" : "The monetary amount of the transaction entry.",
            "example" : 162.0
          },
          "reference" : {
            "type" : "string",
            "description" : "An optional reference number for the transaction."
          },
          "generalLedgerEntries" : {
            "type" : "array",
            "description" : "A list of general ledger entries associated with this offender transaction.",
            "items" : {
              "$ref" : "#/components/schemas/GeneralLedgerEntry"
            }
          }
        },
        "required" : [ "amount", "description", "entrySequence", "generalLedgerEntries", "offenderDisplayId", "offenderId", "postingType", "subAccountType", "type" ]
      },
      "SyncOffenderTransactionRequest" : {
        "type" : "object",
        "description" : "Request body for synchronizing an offender financial transaction.",
        "properties" : {
          "transactionId" : {
            "type" : "integer",
            "format" : "int64",
            "description" : "The unique ID of the transaction in NOMIS.",
            "example" : 19228028
          },
          "requestId" : {
            "type" : "string",
            "format" : "uuid",
            "description" : "A unique identifier for this synchronization request. This can be used for idempotency or tracing.",
            "example" : "a1b2c3d4-e5f6-7890-1234-567890abcdef"
          },
          "caseloadId" : {
            "type" : "string",
            "description" : "The ID of the caseload associated with this transaction.",
            "example" : "GMI"
          },
          "transactionTimestamp" : {
            "type" : "string",
            "format" : "date-time",
            "description" : "The timestamp when this transaction occurred (ISO 8601 format).",
            "example" : "2024-06-18T14:30:00.123456"
          },
          "createdAt" : {
            "type" : "string",
            "format" : "date-time",
            "description" : "The date and time the transaction was created.",
            "example" : "2024-06-18T14:30:00.123456"
          },
          "createdBy" : {
            "type" : "string",
            "description" : "The user id of the person who created the transaction.",
            "example" : "JD12345",
            "maxLength" : 32,
            "minLength" : 1
          },
          "createdByDisplayName" : {
            "type" : "string",
            "description" : "The display name of the person who created the transaction.",
            "example" : "J Doe",
            "maxLength" : 255,
            "minLength" : 1
          },
          "lastModifiedAt" : {
            "type" : "string",
            "format" : "date-time",
            "description" : "The date and time the transaction was last modified. Only provided if the transaction has been modified since creation.",
            "example" : "2022-07-15T23:03:01.123456"
          },
          "lastModifiedBy" : {
            "type" : "string",
            "description" : "The user id of the person who last modified the transaction. Required if lastModifiedAt has been supplied.",
            "example" : "AB11DZ",
            "maxLength" : 32,
            "minLength" : 0
          },
          "lastModifiedByDisplayName" : {
            "type" : "string",
            "description" : "The displayable name of the person who last modified the transaction. Required if lastModifiedAt has been supplied.",
            "example" : "U Dated",
            "maxLength" : 255,
            "minLength" : 0
          },
          "offenderTransactions" : {
            "type" : "array",
            "description" : "A list of individual entries that comprise this offender transaction.",
            "items" : {
              "$ref" : "#/components/schemas/OffenderTransaction"
            }
          }
        },
        "required" : [ "caseloadId", "createdAt", "createdBy", "createdByDisplayName", "offenderTransactions", "requestId", "transactionId", "transactionTimestamp" ]
      },
      "SyncTransactionReceipt" : {
        "type" : "object",
        "description" : "Receipt details for a synchronized transaction, indicating the outcome of the operation.",
        "properties" : {
          "requestId" : {
            "type" : "string",
            "format" : "uuid",
            "description" : "The unique identifier of the **current synchronization request**. This Id was provided by the client as the idempotency key.",
            "example" : "a1b2c3d4-e5f6-7890-1234-567890abcdef"
          },
          "synchronizedTransactionId" : {
            "type" : "string",
            "format" : "uuid",
            "description" : "The unique UUID generated by the **finance system** for the synchronized transaction. This is the internal identifier for the created or updated record.",
            "example" : "f1e2d3c4-b5a6-9876-5432-10fedcba9876"
          },
          "action" : {
            "type" : "string",
            "description" : "The action taken on the transaction by the finance system during synchronization.",
            "enum" : [ "CREATED", "UPDATED", "PROCESSED" ],
            "example" : "CREATED"
          }
        },
        "required" : [ "action", "requestId", "synchronizedTransactionId" ]
      },
      "ErrorResponse" : {
        "type" : "object",
        "properties" : {
          "status" : {
            "type" : "integer",
            "format" : "int32"
          },
          "errorCode" : {
            "type" : "string"
          },
          "userMessage" : {
            "type" : "string"
          },
          "developerMessage" : {
            "type" : "string"
          },
          "moreInfo" : {
            "type" : "string"
          }
        },
        "required" : [ "status" ]
      },
      "SyncGeneralLedgerTransactionRequest" : {
        "type" : "object",
        "description" : "Request body for synchronizing general ledger transactions. Please note these are for non-offender accounts only.",
        "properties" : {
          "transactionId" : {
            "type" : "integer",
            "format" : "int64",
            "description" : "The unique identifier for the general ledger transaction.",
            "example" : 19228028
          },
          "requestId" : {
            "type" : "string",
            "format" : "uuid",
            "description" : "A unique identifier for this synchronization request. This can be used for idempotency or tracing.",
            "example" : "a1b2c3d4-e5f6-7890-1234-567890abcdef"
          },
          "description" : {
            "type" : "string",
            "description" : "A description of the general ledger transaction.",
            "example" : "General Ledger Account Transfer"
          },
          "reference" : {
            "type" : "string",
            "description" : "An optional reference number for the transaction.",
            "example" : "REF12345"
          },
          "caseloadId" : {
            "type" : "string",
            "description" : "The ID of the caseload associated with the transaction.",
            "example" : "GMI"
          },
          "transactionType" : {
            "type" : "string",
            "description" : "The transaction type",
            "example" : "GJ"
          },
          "transactionTimestamp" : {
            "type" : "string",
            "format" : "date-time",
            "description" : "The full timestamp of the transaction (ISO 8601).",
            "example" : "2011-09-30T09:08:08.671682"
          },
          "createdAt" : {
            "type" : "string",
            "format" : "date-time",
            "description" : "The date and time the transaction was created.",
            "example" : "2024-06-18T14:30:00.123456"
          },
          "createdBy" : {
            "type" : "string",
            "description" : "The user ID of the person who created the transaction in the source system.",
            "example" : "JD12345",
            "maxLength" : 32,
            "minLength" : 1
          },
          "createdByDisplayName" : {
            "type" : "string",
            "description" : "The display name of the person who created the transaction.",
            "example" : "J Doe",
            "maxLength" : 255,
            "minLength" : 1
          },
          "lastModifiedAt" : {
            "type" : "string",
            "format" : "date-time",
            "description" : "The date and time the transaction was last modified. Only provided if the transaction has been modified since creation. (ISO 8601 format with offset)",
            "example" : "2022-07-15T23:03:01.123456"
          },
          "lastModifiedBy" : {
            "type" : "string",
            "description" : "The user ID of the person who last modified the transaction. Required if lastModifiedAt has been supplied.",
            "example" : "AB11DZ",
            "maxLength" : 32,
            "minLength" : 0
          },
          "lastModifiedByDisplayName" : {
            "type" : "string",
            "description" : "The displayable name of the person who last modified the transaction. Required if lastModifiedAt has been supplied.",
            "example" : "U Dated",
            "maxLength" : 255,
            "minLength" : 0
          },
          "generalLedgerEntries" : {
            "type" : "array",
            "description" : "A list of general ledger entries associated with this general ledger transaction.",
            "items" : {
              "$ref" : "#/components/schemas/GeneralLedgerEntry"
            }
          }
        },
        "required" : [ "caseloadId", "createdAt", "createdBy", "createdByDisplayName", "description", "generalLedgerEntries", "requestId", "transactionId", "transactionTimestamp", "transactionType" ]
      },
      "PrisonerAccountPointInTimeBalance" : {
        "type" : "object",
        "description" : "Represents a prisoner balance at a specific point in time for synchronization from a legacy system.",
        "properties" : {
          "prisonId" : {
            "type" : "string",
            "description" : "The prison code (e.g., 'MDI') where this specific account balance is held.",
            "minLength" : 1
          },
          "accountCode" : {
            "type" : "integer",
            "format" : "int32",
            "description" : "The account code for the prisoner account."
          },
          "balance" : {
            "type" : "number",
            "description" : "The account balance at the specified time.",
            "example" : 123.45
          },
          "holdBalance" : {
            "type" : "number",
            "description" : "The amount on hold for the sub-account.",
            "example" : 10.0
          },
          "transactionId" : {
            "type" : "integer",
            "format" : "int64",
            "description" : "The transaction ID that resulted in the last update to the prisoner balance."
          },
          "asOfTimestamp" : {
            "type" : "string",
            "format" : "date-time",
            "description" : "The local date and time from the legacy system when this balance was valid.",
            "example" : "2025-09-24T10:00:00"
          }
        },
        "required" : [ "accountCode", "asOfTimestamp", "balance", "holdBalance", "prisonId", "transactionId" ]
      },
      "PrisonerBalancesSyncRequest" : {
        "type" : "object",
        "description" : "A request to synchronize all balances for a single prisoner across their sub-accounts.",
        "properties" : {
          "accountBalances" : {
            "type" : "array",
            "description" : "A list of sub-account balances to be synchronized for the prisoner.",
            "items" : {
              "$ref" : "#/components/schemas/PrisonerAccountPointInTimeBalance"
            },
            "minItems" : 1
          }
        },
        "required" : [ "accountBalances" ]
      },
      "GeneralLedgerBalancesSyncRequest" : {
        "type" : "object",
        "description" : "A request to synchronize general ledger balances for a single prison.",
        "properties" : {
          "accountBalances" : {
            "type" : "array",
            "description" : "A list of general ledger account balances to be synchronized.",
            "items" : {
              "$ref" : "#/components/schemas/GeneralLedgerPointInTimeBalance"
            },
            "minItems" : 1
          }
        },
        "required" : [ "accountBalances" ]
      },
      "GeneralLedgerPointInTimeBalance" : {
        "type" : "object",
        "description" : "Represents a single general ledger account and its balance at a specific point in time.",
        "properties" : {
          "accountCode" : {
            "type" : "integer",
            "format" : "int32",
            "description" : "The account code for the general ledger account."
          },
          "balance" : {
            "type" : "number",
            "description" : "The account balance at the specified time.",
            "example" : 123.45
          },
          "asOfTimestamp" : {
            "type" : "string",
            "format" : "date-time",
            "description" : "The local date and time from the legacy system when this balance was valid.",
            "example" : "2025-09-24T10:00:00"
          }
        },
        "required" : [ "accountCode", "asOfTimestamp", "balance" ]
      },
      "SyncOffenderTransactionResponse" : {
        "type" : "object",
        "description" : "A response containing a list of offender transactions",
        "properties" : {
          "synchronizedTransactionId" : {
            "type" : "string",
            "format" : "uuid",
            "description" : "The unique UUID generated by the **finance system** for the synchronized transaction. This is the internal identifier for the created or updated record.",
            "example" : "f1e2d3c4-b5a6-9876-5432-10fedcba9876"
          },
          "legacyTransactionId" : {
            "type" : "integer",
            "format" : "int64",
            "description" : "The legacy ID of the transaction from the source system. This is only present if the transaction was originally generated by the legacy system.",
            "example" : 123456
          },
          "caseloadId" : {
            "type" : "string",
            "description" : "The ID of the caseload associated with this transaction.",
            "example" : "GMI"
          },
          "transactionTimestamp" : {
            "type" : "string",
            "format" : "date-time",
            "description" : "The timestamp when this transaction occurred (ISO 8601 format).",
            "example" : "2024-06-18T14:30:00.123456"
          },
          "createdAt" : {
            "type" : "string",
            "format" : "date-time",
            "description" : "The date and time the transaction was created.",
            "example" : "2024-06-18T14:30:00.123456"
          },
          "createdBy" : {
            "type" : "string",
            "description" : "The user id of the person who created the transaction.",
            "example" : "JD12345",
            "maxLength" : 32,
            "minLength" : 1
          },
          "createdByDisplayName" : {
            "type" : "string",
            "description" : "The display name of the person who created the transaction.",
            "example" : "J Doe",
            "maxLength" : 255,
            "minLength" : 1
          },
          "lastModifiedAt" : {
            "type" : "string",
            "format" : "date-time",
            "description" : "The date and time the transaction was last modified. Only provided if the transaction has been modified since creation.",
            "example" : "2022-07-15T23:03:01.123456"
          },
          "lastModifiedBy" : {
            "type" : "string",
            "description" : "The user id of the person who last modified the transaction. Required if lastModifiedAt has been supplied.",
            "example" : "AB11DZ",
            "maxLength" : 32,
            "minLength" : 0
          },
          "lastModifiedByDisplayName" : {
            "type" : "string",
            "description" : "The displayable name of the person who last modified the transaction. Required if lastModifiedAt has been supplied.",
            "example" : "U Dated",
            "maxLength" : 255,
            "minLength" : 0
          },
          "transactions" : {
            "type" : "array",
            "description" : "The list of transactions found for the specified offender and date range.",
            "items" : {
              "$ref" : "#/components/schemas/OffenderTransaction"
            }
          }
        },
        "required" : [ "caseloadId", "createdAt", "createdBy", "createdByDisplayName", "synchronizedTransactionId", "transactionTimestamp", "transactions" ]
      },
      "SyncOffenderTransactionListResponse" : {
        "type" : "object",
        "properties" : {
          "offenderTransactions" : {
            "type" : "array",
            "description" : "The list of offender transactions on the current page",
            "items" : {
              "$ref" : "#/components/schemas/SyncOffenderTransactionResponse",
              "description" : "The list of offender transactions on the current page"
            }
          },
          "page" : {
            "type" : "integer",
            "format" : "int32",
            "description" : "The current page number (0-indexed)."
          },
          "totalElements" : {
            "type" : "integer",
            "format" : "int64",
            "description" : "The total number of elements across all pages."
          },
          "totalPages" : {
            "type" : "integer",
            "format" : "int32",
            "description" : "The total number of pages."
          },
          "last" : {
            "type" : "boolean",
            "description" : "Indicates if this is the last page."
          }
        },
        "required" : [ "last", "offenderTransactions", "page", "totalElements", "totalPages" ]
      },
      "SyncGeneralLedgerTransactionResponse" : {
        "type" : "object",
        "description" : "A response containing a general ledger transaction",
        "properties" : {
          "synchronizedTransactionId" : {
            "type" : "string",
            "format" : "uuid",
            "description" : "The unique UUID generated by the **finance system** for the synchronized transaction. This is the internal identifier for the created or updated record.",
            "example" : "f1e2d3c4-b5a6-9876-5432-10fedcba9876"
          },
          "legacyTransactionId" : {
            "type" : "integer",
            "format" : "int64",
            "description" : "The legacy ID of the transaction from the source system. This is only present if the transaction was originally generated by the legacy system.",
            "example" : 123456
          },
          "description" : {
            "type" : "string",
            "description" : "A description of the general ledger transaction.",
            "example" : "General Ledger Account Transfer"
          },
          "reference" : {
            "type" : "string",
            "description" : "An optional reference number for the transaction.",
            "example" : "REF12345"
          },
          "caseloadId" : {
            "type" : "string",
            "description" : "The ID of the caseload associated with the transaction.",
            "example" : "GMI"
          },
          "transactionType" : {
            "type" : "string",
            "description" : "The transaction type",
            "example" : "GJ"
          },
          "transactionTimestamp" : {
            "type" : "string",
            "format" : "date-time",
            "description" : "The full timestamp of the transaction (ISO 8601).",
            "example" : "2011-09-30T09:08:08.671682"
          },
          "createdAt" : {
            "type" : "string",
            "format" : "date-time",
            "description" : "The date and time the transaction was created.",
            "example" : "2024-06-18T14:30:00.123456"
          },
          "createdBy" : {
            "type" : "string",
            "description" : "The user ID of the person who created the transaction in the source system.",
            "example" : "JD12345",
            "maxLength" : 32,
            "minLength" : 1
          },
          "createdByDisplayName" : {
            "type" : "string",
            "description" : "The display name of the person who created the transaction.",
            "example" : "J Doe",
            "maxLength" : 255,
            "minLength" : 1
          },
          "lastModifiedAt" : {
            "type" : "string",
            "format" : "date-time",
            "description" : "The date and time the transaction was last modified. Only provided if the transaction has been modified since creation. (ISO 8601 format with offset)",
            "example" : "2022-07-15T23:03:01.123456"
          },
          "lastModifiedBy" : {
            "type" : "string",
            "description" : "The user ID of the person who last modified the transaction. Required if lastModifiedAt has been supplied.",
            "example" : "AB11DZ",
            "maxLength" : 32,
            "minLength" : 0
          },
          "lastModifiedByDisplayName" : {
            "type" : "string",
            "description" : "The displayable name of the person who last modified the transaction. Required if lastModifiedAt has been supplied.",
            "example" : "U Dated",
            "maxLength" : 255,
            "minLength" : 0
          },
          "generalLedgerEntries" : {
            "type" : "array",
            "description" : "A list of general ledger entries associated with this general ledger transaction.",
            "items" : {
              "$ref" : "#/components/schemas/GeneralLedgerEntry"
            }
          }
        },
        "required" : [ "caseloadId", "createdAt", "createdBy", "createdByDisplayName", "description", "generalLedgerEntries", "synchronizedTransactionId", "transactionTimestamp", "transactionType" ]
      },
      "SyncGeneralLedgerTransactionListResponse" : {
        "type" : "object",
        "description" : "A response containing a list of general ledger transactions.",
        "properties" : {
          "transactions" : {
            "type" : "array",
            "description" : "The list of general ledger transactions on the current page",
            "items" : {
              "$ref" : "#/components/schemas/SyncGeneralLedgerTransactionResponse",
              "description" : "The list of general ledger transactions on the current page"
            }
          },
          "page" : {
            "type" : "integer",
            "format" : "int32",
            "description" : "The current page number (0-indexed)."
          },
          "totalElements" : {
            "type" : "integer",
            "format" : "int64",
            "description" : "The total number of elements across all pages."
          },
          "totalPages" : {
            "type" : "integer",
            "format" : "int32",
            "description" : "The total number of pages."
          },
          "last" : {
            "type" : "boolean",
            "description" : "Indicates if this is the last page."
          }
        },
        "required" : [ "last", "page", "totalElements", "totalPages", "transactions" ]
      },
      "PrisonerEstablishmentBalanceDetails" : {
        "type" : "object",
        "description" : "Summary of a prisoner's sub account balance at a specific establishment.",
        "properties" : {
          "prisonId" : {
            "type" : "string",
            "description" : "The establishment code where the transactions for this balance occurred.",
            "example" : "LEI"
          },
          "accountCode" : {
            "type" : "integer",
            "format" : "int32",
            "description" : "The unique numeric code identifying the sub account.",
            "example" : 2101
          },
          "totalBalance" : {
            "type" : "number",
            "description" : "The current monetary balance of the sub account at this establishment. This value can be positive or negative.",
            "example" : 32.0
          },
          "holdBalance" : {
            "type" : "number",
            "description" : "The total amount on hold for this sub account at this establishment.",
            "example" : 8.0
          }
        },
        "required" : [ "accountCode", "holdBalance", "prisonId", "totalBalance" ]
      },
      "PrisonerEstablishmentBalanceDetailsList" : {
        "type" : "object",
        "description" : "A list of a prisoner's sub account balances, broken down by establishment.",
        "properties" : {
          "items" : {
            "type" : "array",
            "items" : {
              "$ref" : "#/components/schemas/PrisonerEstablishmentBalanceDetails"
            }
          }
        },
        "required" : [ "items" ]
      },
      "GeneralLedgerBalanceDetails" : {
        "type" : "object",
        "description" : "Balance of prison general ledger account",
        "properties" : {
          "accountCode" : {
            "type" : "integer",
            "format" : "int32",
            "description" : "The unique account code identifying the prison general ledger account.",
            "example" : 1021
          },
          "balance" : {
            "type" : "number",
            "description" : "The current monetary balance of the prison general ledger account. This value can be positive or negative.",
            "example" : 1234.56
          }
        },
        "required" : [ "accountCode", "balance" ]
      },
      "GeneralLedgerBalanceDetailsList" : {
        "type" : "object",
        "description" : "A list of general ledger account balances",
        "properties" : {
          "items" : {
            "type" : "array",
            "items" : {
              "$ref" : "#/components/schemas/GeneralLedgerBalanceDetails"
            }
          }
        },
        "required" : [ "items" ]
      },
      "DlqMessage" : {
        "type" : "object",
        "properties" : {
          "body" : {
            "type" : "object",
            "additionalProperties" : { }
          },
          "messageId" : {
            "type" : "string"
          }
        },
        "required" : [ "body", "messageId" ]
      },
      "GetDlqResult" : {
        "type" : "object",
        "properties" : {
          "messagesFoundCount" : {
            "type" : "integer",
            "format" : "int32"
          },
          "messagesReturnedCount" : {
            "type" : "integer",
            "format" : "int32"
          },
          "messages" : {
            "type" : "array",
            "items" : {
              "$ref" : "#/components/schemas/DlqMessage"
            }
          }
        },
        "required" : [ "messages", "messagesFoundCount", "messagesReturnedCount" ]
      },
      "PostingReportEntry" : {
        "type" : "object",
        "properties" : {
          "date" : {
            "type" : "string",
            "format" : "date"
          },
          "businessDate" : {
            "type" : "string",
            "format" : "date"
          },
          "transactionUsage" : {
            "type" : "string"
          },
          "type" : {
            "type" : "string"
          },
          "description" : {
            "type" : "string"
          },
          "private" : {
            "type" : "number"
          },
          "spending" : {
            "type" : "number"
          },
          "saving" : {
            "type" : "number"
          },
          "credits" : {
            "type" : "number"
          },
          "debits" : {
            "type" : "number"
          },
          "total" : {
            "type" : "number"
          }
        },
        "required" : [ "businessDate", "credits", "date", "debits", "description", "private", "saving", "spending", "total", "type" ]
      },
      "SummaryOfPaymentAndReceiptsReport" : {
        "type" : "object",
        "properties" : {
          "postings" : {
            "type" : "array",
            "items" : {
              "$ref" : "#/components/schemas/PostingReportEntry"
            }
          }
        },
        "required" : [ "postings" ]
      },
      "PrisonAccountDetails" : {
        "type" : "object",
        "description" : "Summary of a prison general ledger account",
        "properties" : {
          "code" : {
            "type" : "integer",
            "format" : "int32",
            "description" : "The unique numeric code identifying the prison general ledger account.",
            "example" : 1000
          },
          "name" : {
            "type" : "string",
            "description" : "The human-readable name of the prison general ledger account (e.g., 'Cash', 'Bank Account', 'Accounts Payable').",
            "example" : "Cash"
          },
          "prisonId" : {
            "type" : "string",
            "description" : "The prison id that owns this general ledger account.",
            "example" : "LEI"
          },
          "classification" : {
            "type" : "string",
            "description" : "The classification of the prison general ledger account. Values include 'Asset', 'Liability', 'Receipt', and 'Disbursement'.",
            "enum" : [ "Asset", "Liability", "Receipt", "Disbursement" ],
            "example" : "Asset"
          },
          "postingType" : {
            "type" : "string",
            "description" : "The natural transaction posting type for this prison general ledger account. 'DR' indicates a Debit posting, while 'CR' indicates a Credit posting.",
            "enum" : [ "DR", "CR" ],
            "example" : "DR"
          },
          "balance" : {
            "type" : "number",
            "description" : "The current monetary balance of the prison general ledger account. This value can be positive or negative.",
            "example" : 1234.56
          }
        },
        "required" : [ "balance", "classification", "code", "name", "postingType", "prisonId" ]
      },
      "PrisonAccountDetailsList" : {
        "type" : "object",
        "description" : "A list of accounts for a specific prison",
        "properties" : {
          "items" : {
            "type" : "array",
            "items" : {
              "$ref" : "#/components/schemas/PrisonAccountDetails"
            }
          }
        },
        "required" : [ "items" ]
      },
      "TransactionAccountDetails" : {
        "type" : "object",
        "properties" : {
          "code" : {
            "type" : "integer",
            "format" : "int32"
          },
          "name" : {
            "type" : "string"
          },
          "transactionType" : {
            "type" : "string"
          },
          "transactionDescription" : {
            "type" : "string"
          },
          "prison" : {
            "type" : "string"
          },
          "prisoner" : {
            "type" : "string"
          },
          "classification" : {
            "type" : "string"
          },
          "postingType" : {
            "type" : "string",
            "enum" : [ "DR", "CR" ]
          }
        },
        "required" : [ "classification", "code", "name", "postingType" ]
      },
      "TransactionDetails" : {
        "type" : "object",
        "properties" : {
          "id" : {
            "type" : "string"
          },
          "date" : {
            "type" : "string"
          },
          "type" : {
            "type" : "string"
          },
          "description" : {
            "type" : "string"
          },
          "reference" : {
            "type" : "string"
          },
          "clientRequestId" : {
            "type" : "string"
          },
          "postings" : {
            "type" : "array",
            "items" : {
              "$ref" : "#/components/schemas/TransactionPosting"
            }
          }
        },
        "required" : [ "date", "id", "postings", "type" ]
      },
      "TransactionDetailsList" : {
        "type" : "object",
        "properties" : {
          "items" : {
            "type" : "array",
            "items" : {
              "$ref" : "#/components/schemas/TransactionDetails"
            }
          }
        },
        "required" : [ "items" ]
      },
      "TransactionPosting" : {
        "type" : "object",
        "properties" : {
          "account" : {
            "$ref" : "#/components/schemas/TransactionAccountDetails"
          },
          "address" : {
            "type" : "string"
          },
          "postingType" : {
            "type" : "string",
            "enum" : [ "DR", "CR" ]
          },
          "amount" : {
            "type" : "number"
          }
        },
        "required" : [ "amount", "postingType" ]
      },
      "PrisonerSubAccountDetails" : {
        "type" : "object",
        "description" : "Summary of a prisoner sub account",
        "properties" : {
          "code" : {
            "type" : "integer",
            "format" : "int32",
            "description" : "The unique numeric code identifying the sub account.",
            "example" : 1000
          },
          "name" : {
            "type" : "string",
            "description" : "The human-readable name of the sub account (e.g., 'Private Cash', 'Savings', 'Spends').",
            "example" : "Savings"
          },
          "prisonNumber" : {
            "type" : "string",
            "description" : "Prison number of the prisoner. Also referred to as the offender number, offender id or NOMS id",
            "example" : "Z9090ZZ"
          },
          "balance" : {
            "type" : "number",
            "description" : "The current monetary balance of the sub account. This value can be positive or negative.",
            "example" : 1234.56
          },
          "holdBalance" : {
            "type" : "number",
            "description" : "The total amount on hold for this sub account",
            "example" : 10.0
          }
        },
        "required" : [ "balance", "code", "holdBalance", "name", "prisonNumber" ]
      },
      "PrisonerSubAccountDetailsList" : {
        "type" : "object",
        "description" : "A list of prisoner sub-accounts (e.g., Cash, Spends, Savings)",
        "properties" : {
          "items" : {
            "type" : "array",
            "items" : {
              "$ref" : "#/components/schemas/PrisonerSubAccountDetails"
            }
          }
        },
        "required" : [ "items" ]
      },
      "NomisSyncPayloadSummary" : {
        "type" : "object",
        "properties" : {
          "timestamp" : {
            "type" : "string",
            "format" : "date-time"
          },
          "caseloadId" : {
            "type" : "string"
          },
          "transactionTimestamp" : {
            "type" : "string",
            "format" : "date-time"
          },
          "synchronizedTransactionId" : {
            "type" : "string",
            "format" : "uuid"
          },
          "legacyTransactionId" : {
            "type" : "integer",
            "format" : "int64"
          },
          "requestId" : {
            "type" : "string",
            "format" : "uuid"
          },
          "requestTypeIdentifier" : {
            "type" : "string"
          }
        },
        "required" : [ "requestId", "synchronizedTransactionId", "timestamp" ]
      },
      "PageNomisSyncPayloadSummary" : {
        "type" : "object",
        "properties" : {
          "totalElements" : {
            "type" : "integer",
            "format" : "int64"
          },
          "totalPages" : {
            "type" : "integer",
            "format" : "int32"
          },
          "size" : {
            "type" : "integer",
            "format" : "int32"
          },
          "content" : {
            "type" : "array",
            "items" : {
              "$ref" : "#/components/schemas/NomisSyncPayloadSummary"
            }
          },
          "number" : {
            "type" : "integer",
            "format" : "int32"
          },
          "sort" : {
            "$ref" : "#/components/schemas/SortObject"
          },
          "first" : {
            "type" : "boolean"
          },
          "last" : {
            "type" : "boolean"
          },
          "numberOfElements" : {
            "type" : "integer",
            "format" : "int32"
          },
          "pageable" : {
            "$ref" : "#/components/schemas/PageableObject"
          },
          "empty" : {
            "type" : "boolean"
          }
        }
      },
      "PageableObject" : {
        "type" : "object",
        "properties" : {
          "offset" : {
            "type" : "integer",
            "format" : "int64"
          },
          "sort" : {
            "$ref" : "#/components/schemas/SortObject"
          },
          "pageSize" : {
            "type" : "integer",
            "format" : "int32"
          },
          "unpaged" : {
            "type" : "boolean"
          },
          "paged" : {
            "type" : "boolean"
          },
          "pageNumber" : {
            "type" : "integer",
            "format" : "int32"
          }
        }
      },
      "SortObject" : {
        "type" : "object",
        "properties" : {
          "empty" : {
            "type" : "boolean"
          },
          "sorted" : {
            "type" : "boolean"
          },
          "unsorted" : {
            "type" : "boolean"
          }
        }
      },
      "NomisSyncPayloadDetail" : {
        "type" : "object",
        "properties" : {
          "timestamp" : {
            "type" : "string",
            "format" : "date-time"
          },
          "legacyTransactionId" : {
            "type" : "integer",
            "format" : "int64"
          },
          "synchronizedTransactionId" : {
            "type" : "string",
            "format" : "uuid"
          },
          "requestId" : {
            "type" : "string",
            "format" : "uuid"
          },
          "caseloadId" : {
            "type" : "string"
          },
          "requestTypeIdentifier" : {
            "type" : "string"
          },
          "transactionTimestamp" : {
            "type" : "string",
            "format" : "date-time"
          },
          "body" : {
            "type" : "string"
          }
        },
        "required" : [ "body", "requestId", "synchronizedTransactionId", "timestamp" ]
      }
    },
    "securitySchemes" : {
      "bearer-jwt" : {
        "type" : "http",
        "description" : "A HMPPS Auth access token with the `ROLE_PRISONER_FINANCE_SYNC__RW` role.",
        "name" : "Authorization",
        "in" : "header",
        "scheme" : "bearer",
        "bearerFormat" : "JWT"
      }
    }
  }
}